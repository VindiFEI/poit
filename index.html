<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nase kuzelne zadanie z najoblubenjsieho predmetu</title>
    <style type="text/css"></style>
    <script src="static/libs/jquery-1.11.1.min.js"></script>
    <script src="static/libs/plotly-latest.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
        var x = new Array();
        var y = new Array();
        var trace;
        var layout;
        var i = 0;
        var x_h = new Array();
        var y_h = new Array();
        var trace_h;
        var layout_h;
        var j = 0;
        
        namespace = '/'
        var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

        socket.on('json_data', function(msg) {
        console.log(msg.data);
        var json_string = jQuery.parseJSON(msg.data);
        $('#log').append('Received: '+json_string.temperature_C+ ', ' +json_string.temperature_F+ ', ' +json_string.humidity+ ', '  +json_string.ppm+'<br>').html();
        x.push(parseFloat(i++));
        x_h.push(parseFloat(j++));
        //pridat podmienku, ci chcem celsius alebo fahrenheit(zmenim 0 na 1)
        y.push(parseFloat(json_string.temperature_C));
        y_h.push(parseFloat(json_string.humidity));
        //teplota
        trace = {
            x: x,
            y: y,
        };       
        layout = {
          title: 'Teplota',
          xaxis: {
              title: 'x',
          },
          yaxis: {
              title: 'y',
          }
        };
        console.log(trace);
        var traces = new Array();
        traces.push(trace);
        Plotly.newPlot($('#plotdiv')[0], traces, layout);
        //vlhkost
        trace_h = {
            x: x_h,
            y: y_h,
        };       
        layout_h = {
          title: 'Vlhkost',
          xaxis: {
              title: 'x',
          },
          yaxis: {
              title: 'y',
          }
        };
        console.log(trace_h);
        var traces_h = new Array();
        traces_h.push(trace_h);
        Plotly.newPlot($('#plotdiv2')[0], traces_h, layout_h);  
        });
        
        socket.on('db_data', function(msg) {
        for(var i = 0; i < (msg.data).length; i++, j++){
            //pridat podmienku, ci chcem celsius alebo fahrenheit(zmenim 0 na 1)
            y.push(parseFloat(msg.data[i][0]));
            y_h.push(parseFloat(msg.data[i][2]));
            x.push(parseFloat(i));
            x_h.push(parseFloat(j));
            $('#log').append('Received: '+msg.data[i][0]+ ', ' +msg.data[i][1]+ ', ' +msg.data[i][2]+  ', ' +msg.data[i][3]+ '<br>').html(); 
        }
        //teplota
        trace = {
            x: x,
            y: y,
        };       
        layout = {
          title: 'Teplota',
          xaxis: {
              title: 'x',
          },
          yaxis: {
              title: 'y',
          }
        };
        console.log(trace);
        var traces = new Array();
        traces.push(trace);
        Plotly.newPlot($('#plotdiv')[0], traces, layout); 
        //vlhkost
        trace_h = {
            x: x_h,
            y: y_h,
        };       
        layout_h = {
          title: 'Vlhkost',
          xaxis: {
              title: 'x',
          },
          yaxis: {
              title: 'y',
          }
        };
        console.log(trace_h);
        var traces_h = new Array();
        traces_h.push(trace_h);
        Plotly.newPlot($('#plotdiv2')[0], traces_h, layout_h); 
        });
        
        socket.on('file_data', function(msg) {
        console.log(msg.data);
        var json_string = jQuery.parseJSON(msg.data);
        $('#log').append('Received: '+json_string.temperature_C+ ', ' +json_string.temperature_F+ ', ' +json_string.humidity+ ', '  +json_string.ppm+'<br>').html();
        x.push(parseFloat(i++));
        x_h.push(parseFloat(j++));
        //pridat podmienku, ci chcem celsius alebo fahrenheit(zmenim 0 na 1)
        y.push(parseFloat(json_string.temperature_C));
        y_h.push(parseFloat(json_string.humidity));
        //teplota
        trace = {
            x: x,
            y: y,
        };       
        layout = {
          title: 'Teplota',
          xaxis: {
              title: 'x',
          },
          yaxis: {
              title: 'y',
          }
        };
        console.log(trace);
        var traces = new Array();
        traces.push(trace);
        Plotly.newPlot($('#plotdiv')[0], traces, layout);
        
        //vlhkost
        trace_h = {
            x: x_h,
            y: y_h,
        };       
        layout_h = {
          title: 'Vlhkost',
          xaxis: {
              title: 'x',
          },
          yaxis: {
              title: 'y',
          }
        };
        console.log(trace_h);
        var traces_h = new Array();
        traces_h.push(trace_h);
        Plotly.newPlot($('#plotdiv2')[0], traces_h, layout_h); 
        });
        
        $('#buttonVal').click(function(event) {
            console.log($('#buttonVal').val());
            socket.emit('start_stop_request',{value: $('#buttonVal').val()});
            if ($(this).val() == "start") {
                $(this).val("stop");
                $(this).text("Stop");
            }
            else {
                $(this).val("start");
                $(this).text("Start");
            }
        return false; });
        
        $('#connect').click(function(event) {
            console.log($('#connect').val());
            socket.emit('connect_request');
            return false; });
        $('#disconnect').click(function(event) {
            console.log($('#disconnect').val());
            socket.emit('disconnect_request');
            return false; });
        $('#delete').click(function(event) {
            console.log($('#delete').val());
            socket.emit('delete_request');
            return false; });
        $('#delete_file').click(function(event) {
            console.log($('#delete_file').val());
            socket.emit('delete_request_file');
            return false; });
        $('#load').click(function(event) {
            console.log($('#load').val());
            socket.emit('load_request');
            return false; });
        $('#load_file').click(function(event) {
            console.log($('#load_file').val());
            socket.emit('load_request_file');
            return false; });
        });
    </script>
</head>
<body>
    <h1>Senzory! VSADE SAME SENZORY</h1>
    <p>Hello there!</p>
    <p>General Kenobi!</p>
    <button id="connect" type="submit" value="connect">Open</button>
    <button id="disconnect" type="submit" value="disconnect">Close</button>
    <button id="delete" type="submit" value="delete">Delete</button>
    <button id="delete_file" type="submit" value="delete_file">Delete file</button>
    <button id="buttonVal" type="submit" value="start">Start</button>
    <button id="load" type="submit" value="load">Load database</button>
    <button id="load_file" type="submit" value="load_file">Load file</button>
    <div id="plotdiv" style="width:600px;height:250px;"></div>
    <div id="plotdiv2" style="width:600px;height:250px;"></div>
    <h2>Receive:</h2>
        <div id="log"></div>
</body>
</html> 
